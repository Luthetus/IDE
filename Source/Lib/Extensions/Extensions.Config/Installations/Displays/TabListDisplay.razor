@using Clair.Common.RazorLib.Dropdowns.Displays
@using Clair.Common.RazorLib.Dropdowns.Models
@using Clair.Common.RazorLib.Notifications.Models
@using Clair.Common.RazorLib.Notifications.Models;
@using Clair.Common.RazorLib.Dynamics.Models
@using Clair.Common.RazorLib.Panels.Models

<div class="ci_dynamic-tab-list">

	@{
	    var textEditorState = DotNetService.TextEditorService.TextEditorState;
	    
	    var textEditorGroup = DotNetService.TextEditorService.Group_GetTextEditorGroupState().EditorTextEditorGroup;
	    
    	_tabCascadingValueBatch.HandleTabButtonOnContextMenu = HandleTabButtonOnContextMenu;
    	_tabCascadingValueBatch.SubscribeToDragEventForScrolling = SubscribeToDragEventForScrolling;
    }

	@foreach (var viewModelKey in textEditorGroup.ViewModelKeyList)
	{
        var viewModel = textEditorState.ViewModelGetOrDefault(viewModelKey);
        
        if (viewModel is not null)
        {
            viewModel.PersistentState.TabGroup = textEditorGroup;
            IPanelTab? panelTab = viewModel.PersistentState;
            panelTab.TabCascadingValueBatch = _tabCascadingValueBatch;
        
            <button class="@GetCssClass(panelTab)"
                    title="@panelTab.TitleVerbose"
            		@key="panelTab.DynamicViewModelKey"
            		@onclick="panelTab.OnClick"
                    @onmousedown="panelTab.HandleOnMouseDownAsync"
                    @onmouseup="HandleOnMouseUp"
                    @onmouseout="panelTab.HandleOnMouseOutAsync"
            		@oncontextmenu:preventDefault="true"
            		@oncontextmenu="panelTab.ManuallyPropagateOnContextMenu">
            	<span class="ci_dynamic-tab-text">@panelTab.Title</span>
            
                <button class="ci_button ci_button-close"
        	            @onclick:stopPropagation="true"
        	            @onclick="panelTab.CloseTabOnClickAsync">
    	            @* IconKind.Close *@
                    <svg width="@DotNetService.CommonService.Options_IconSizeCssValue" height="@DotNetService.CommonService.Options_IconSizeCssValue" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.116 8l-4.558 4.558.884.884L8 8.884l4.558 4.558.884-.884L8.884 8l4.558-4.558-.884-.884L8 7.116 3.442 2.558l-.884.884L7.116 8z" /></svg>
        	    </button>
            </button>
        }
	}
</div>
